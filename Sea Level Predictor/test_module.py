import unittest
import sea_level_predictor
import matplotlib as mpl
import numpy as np

mpl.use('Agg')

# the test case
class LinePlotTestCase(unittest.TestCase):
    def setUp(self):
        self.ax = sea_level_predictor.draw_plot()

    def test_plot_title(self):
        actual = self.ax.get_title()
        expected = "Rise in Sea Level"
        self.assertEqual(actual, expected, "Expected line plot title to be 'Rise in Sea Level'")

    def test_plot_labels(self):
        actual = self.ax.get_xlabel()
        expected = "Year"
        self.assertEqual(actual, expected, "Expected line plot xlabel to be 'Year'")
        actual = self.ax.get_ylabel()
        expected = "Sea Level (inches)"
        self.assertEqual(actual, expected, "Expected line plot ylabel to be 'Sea Level (inches)'")
        actual = self.ax.get_xticks().tolist()
        expected = [1850.0, 1875.0, 1900.0, 1925.0, 1950.0, 1975.0, 2000.0, 2025.0, 2050.0, 2075.0]
        self.assertEqual(actual, expected, "Expected x tick labels to be '1850.0, 1875.0, 1900.0, 1925.0, 1950.0, 1975.0, 2000.0, 2025.0, 2050.0, 2075.0'")

    def test_plot_data_points(self):
        actual = self.ax.get_children()[0].get_offsets().data.tolist()
        expected = [[1880.0, 0.0], [1881.0, 0.220472441], [1882.0, -0.440944881], [1883.0, -0.232283464], [1884.0, 0.590551181], [1885.0, 0.531496062], [1886.0, 0.437007874], [1887.0, 0.216535433], [1888.0, 0.299212598], [1889.0, 0.362204724], [1890.0, 0.440944881], [1891.0, 0.374015748], [1892.0, 0.499999999], [1893.0, 0.685039369], [1894.0, 0.303149606], [1895.0, 0.219488189], [1896.0, 0.327149606], [1897.0, 0.614173228], [1898.0, 0.716535433], [1899.0, 0.80314961], [1900.0, 0.850393701], [1901.0, 1.016142732], [1902.0, 0.952755906], [1903.0, 1.059055118], [1904.0, 0.939370079], [1905.0, 0.968503937], [1906.0, 1.080314961], [1907.0, 0.855118111], [1908.0, 0.688976378], [1909.0, 0.848818898], [1910.0, 0.842519685], [1911.0, 0.850393701], [1912.0, 0.906496062], [1913.0, 0.95748031], [1914.0, 1.233070866], [1915.0, 1.214960630], [1916.0, 1.157480315], [1917.0, 0.945669291], [1918.0, 1.102362205], [1919.0, 1.090551181], [1920.0, 1.245275591], [1921.0, 1.256692913], [1922.0, 1.276377953], [1923.0, 1.249212598], [1924.0, 1.305118110], [1925.0, 1.229133858], [1926.0, 1.272440945], [1927.0, 1.301574803], [1928.0, 1.401574803], [1929.0, 1.373229916], [1930.0, 1.350393701], [1931.0, 1.423622047], [1932.0, 1.589370079], [1933.0, 1.631496063], [1934.0, 1.719488189], [1935.0, 1.696651974], [1936.0, 1.568503937], [1937.0, 1.660629921], [1938.0, 1.820866142], [1939.0, 1.936220472], [1940.0, 1.926181102], [1941.0, 1.988582677], [1942.0, 2.110826772], [1943.0, 2.132874016], [1944.0, 2.163007874], [1945.0, 2.065354331], [1946.0, 2.104330709], [1947.0, 2.086220472], [1948.0, 2.032283464], [1949.0, 2.131496063], [1950.0, 2.194488189], [1951.0, 2.333858268], [1952.0, 2.400393701], [1953.0, 2.530314961], [1954.0, 2.507874016], [1955.0, 2.533464567], [1956.0, 2.607480315], [1957.0, 2.769291339], [1958.0, 2.835433070], [1959.0, 2.965354331], [1960.0, 3.015748031], [1961.0, 3.077755906], [1962.0, 3.212598425], [1963.0, 3.256692913], [1964.0, 3.207874016], [1965.0, 3.227559055], [1966.0, 3.427755906], [1967.0, 3.527755906], [1968.0, 3.621456693], [1969.0, 3.826771654], [1970.0, 3.928740157], [1971.0, 4.011417323], [1972.0, 4.094094488], [1973.0, 4.250393701], [1974.0, 4.311023622], [1975.0, 4.334645669], [1976.0, 4.405511811], [1977.0, 4.462598425], [1978.0, 4.570866142], [1979.0, 4.782283464], [1980.0, 4.902755906], [1981.0, 5.003937008], [1982.0, 5.049212598], [1983.0, 5.199212598], [1984.0, 5.245275591], [1985.0, 5.354330709], [1986.0, 5.443307087], [1987.0, 5.577755906], [1988.0, 5.788582677], [1989.0, 5.767716535], [1990.0, 5.887007874], [1991.0, 5.977755906], [1992.0, 5.990039370], [1993.0, 6.206299213], [1994.0, 6.367716535], [1995.0, 6.561417323], [1996.0, 6.568110236], [1997.0, 6.758582677], [1998.0, 6.876377953], [1999.0, 6.983464567], [2000.0, 7.131496063], [2001.0, 7.275590551], [2002.0, 7.433070866], [2003.0, 7.467716535], [2004.0, 7.577755906], [2005.0, 7.750393701], [2006.0, 7.808464567], [2007.0, 7.987007874], [2008.0, 8.106299213], [2009.0, 8.142913386], [2010.0, 8.252952756], [2011.0, 8.334645669], [2012.0, 8.458267716], [2013.0, 8.558267716], [2014.0, 8.565354331]]
        np.testing.assert_almost_equal(actual, expected, 7, "Expected different data points in scatter plot.")

    def test_plot_lines(self):
        actual = self.ax.get_lines()[0].get_ydata().tolist()
        expected = [-0.5421240249263661, -0.4790794409142336, -0.41603485690208686, -0.3529902728899543, -0.2899456888778218, -0.22690110486568926, -0.16385652085355673, -0.1008119368414242, -0.037767352829277456, 0.025277231182855076, 0.08832181519498761, 0.15136639920712014, 0.21441098321925267, 0.2774555672313852, 0.34050015124351773, 0.4035447352556645, 0.466589319267797, 0.5296339032799295, 0.5926784872920621, 0.6557230713042047, 0.7187676553163373, 0.7818122393284699, 0.8448568233406024, 0.907901407352735, 0.9709459913648676, 1.0339905753770001, 1.0970351593891327, 1.1600797434012653, 1.2231243274133979, 1.2861689114255304, 1.349213495437663, 1.4122580794497956, 1.4753026634619282, 1.5383472474740607, 1.6013918314861933, 1.6644364154983259, 1.7274810042866235, 1.7905255883010348, 1.8535701723131674, 1.91661475632530, 1.9796593403374326, 2.0427039243495652, 2.1057485083616978, 2.1687930923738303, 2.231837676386063, 2.294882260398196, 2.357926844410328, 2.420971428422461, 2.484016012434593, 2.547060596446726, 2.610105180458858, 2.673149764470991, 2.736194348483123, 2.799238932495256, 2.862283516507388, 2.925328100519521, 2.9883726845316536, 3.051417268543786, 3.114461852555919, 3.177506436568051, 3.240551020580184, 3.303595604592316, 3.366640188604449, 3.429684772616581, 3.492729356628714, 3.555773940640846, 3.618818524652979, 3.681863108665111, 3.744907692677244, 3.807952276689376, 3.870996860701509]
        np.testing.assert_almost_equal(actual, expected, 7, "Expected different line for first line of best fit.")
        actual = self.ax.get_lines()[1].get_ydata().tolist()
        expected = [7.06107985777146, 7.227507131103323, 7.393934404435242, 7.560361677767105, 7.726788951098968, 7.89321622443083, 8.059643497762693, 8.226070771094555, 8.392498044426418, 8.55892531775828, 8.725352591090143, 8.891779864422006, 9.058207137753925, 9.224634411085788, 9.39106168441765, 9.557488957749513, 9.723916231081375, 9.890343504413238, 10.0567707777451, 10.223198051076963, 10.38962532440877]
        np.testing.assert_almost_equal(actual, expected, 7, "Expected different line for second line of best fit.")


if __name__ == "__main__":
    unittest.main()
